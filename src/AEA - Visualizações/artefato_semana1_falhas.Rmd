---
title: "R Notebook"
output: html_notebook
---

# Explora√ß√£o Tabela

```{r}
head(InteliFalhas, n=10)
```

```{r}
str(InteliFalhas)
```

```{r}
summary(InteliFalhas)
```

# Limpeza das colunas

Com base na an√°lise das vari√°veis, decidi remover as descri√ß√µes dos IDs, pois eles j√° representam suas pr√≥prias informa√ß√µes. Al√©m disso, removemos a linha e coluna (cartesiano da posi√ß√£o da falha) , uma vez que n√£o √© nescessario ja que ja temos o campo

```{r}
final_data <- InteliFalhas[, c("ID", "DATA DETECCAO", "PONTO","LOC_ID","POS_ID","TYPE_ID","VIEW_ID")]
head(final_data)
```

```{r}
head(final_data)

```

# Visualiza√ß√µes dos Dados

Nesta se√ß√£o, inserimos as visualiza√ß√µes que facilitar√£o a identifica√ß√£o de padr√µes.

```{r}
library(ggplot2)
library(dplyr)
library(lubridate)
```

Convertemos essa coluna para POSIXct e extra√≠mos apenas a data

```{r}
final_data <- final_data %>%
  mutate(
    DATA_DETEC = as.POSIXct(`DATA DETECCAO`, format = "%Y-%m-%d-%H.%M.%OS", tz = "UTC"),
    date = as.Date(DATA_DETEC)
  )
```

## Visualiza√ß√£o 1: Falhas por Etapa (PONTO)

Esta visualiza√ß√£o mostra a frequ√™ncia de falhas em cada etapa do processo.

```{r}
ggplot(final_data, aes(x = PONTO)) +
  geom_bar(fill = "steelblue") +
  labs(title = "Frequ√™ncia de Falhas por Etapa (PONTO)",
       x = "Etapa do Processo",
       y = "N√∫mero de Falhas") +
  theme_minimal()
```

## Visualiza√ß√£o 2: Frequ√™ncia de Falhas por Parte do Carro (LOC_ID)

```{r}
#Converter a coluna LOC_ID para fator
final_data$LOC_ID <- as.factor(final_data$LOC_ID)

# Calcular os top 10 LOC_ID (com maiores contagens)
top_locs <- final_data %>%
  count(LOC_ID, sort = TRUE) %>%
  slice(1:10) %>%
  pull(LOC_ID)

# Filtrar o dataset para manter apenas os top 10 e reordenar os n√≠veis do fator
final_data_top <- final_data %>%
  filter(LOC_ID %in% top_locs) %>%
  mutate(LOC_ID = fct_infreq(LOC_ID))  # fct_infreq ordena do mais frequente para o menos

# Plotar o gr√°fico com os top 10 LOC_ID
ggplot(final_data_top, aes(x = LOC_ID)) +
  geom_bar(stat = "count", fill = "tomato") +
  labs(title = "Frequ√™ncia de Falhas por Parte do Carro (Top 10 LOC_ID)",
       x = "Parte do Carro",
       y = "N√∫mero de Falhas") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8))
```

## Visualiza√ß√£o 3: Evolu√ß√£o Di√°ria das Falhas

Agregar os dados di√°rios, removendo registros com data inv√°lida

```{r}
daily_failures <- final_data %>%
  filter(!is.na(date) & date >= as.Date("2021-01-01")) %>%
  group_by(date) %>%
  summarise(total_failures = n()) %>%
  filter(total_failures > 0)

# Plotar o gr√°fico com dados a partir de 2021, sem os dias com 0 falhas
ggplot(daily_failures, aes(x = date, y = total_failures)) +
  geom_line(color = "darkgreen") +
  geom_point(color = "darkgreen") +
  labs(title = "Evolu√ß√£o Di√°ria das Falhas (a partir de 2021, IDs com repeti√ß√£o)",
       x = "Data",
       y = "N√∫mero de Falhas") +
  scale_x_date(date_breaks = "1 month", date_labels = "%b-%Y") +
  theme_minimal()
```

```{r}
daily_failures_unique <- final_data %>%
  filter(!is.na(date) & date >= as.Date("2021-01-01")) %>%
  distinct(ID, date, .keep_all = TRUE) %>%  # Remove duplicatas com base em ID (para cada dia)
  group_by(date) %>%
  summarise(total_failures = n())

# Plotar o gr√°fico com dados a partir de 2021, sem os dias com 0 falhas
ggplot(daily_failures_unique, aes(x = date, y = total_failures)) +
  geom_line(color = "darkgreen") +
  geom_point(color = "darkgreen") +
  labs(title = "Evolu√ß√£o Di√°ria das Falhas (a partir de 2021, IDs √∫nicos)",
       x = "Data",
       y = "N√∫mero de Falhas") +
  scale_x_date(date_breaks = "1 month", date_labels = "%b-%Y") +
  theme_minimal()
```

# Relat√≥rio

### üîç Altera√ß√µes realizadas

-   **Removemos descri√ß√µes do campo `ID`**, pois ele j√° representa a informa√ß√£o de forma otimizada.\
-   **Exclu√≠mos colunas de posi√ß√£o cartesiana**, pois `POS_ID` j√° atende essa necessidade.

### üìå Colunas selecionadas para a vers√£o final

-   **`ID`** ‚Üí Identificador √∫nico do carro.\
-   **`DATA DETECCAO`** ‚Üí Data e hora da detec√ß√£o da falha.\
-   **`PONTO`** ‚Üí Etapa onde ocorreu a falha (Ex.: ZP, Rodagem, √Ågua).\
-   **`LOC_ID`** ‚Üí Parte do carro afetada (Ex.: Tampa traseira, Alavanca do freio manual).\
-   **`POS_ID`** ‚Üí Posi√ß√£o da falha (Ex.: Direita, Esquerda, Superior esquerda).\
-   **`TYPE_ID`** ‚Üí Tipo de erro identificado (Ex.: Repuxado de cola, Res√≠duo de soldagem).\
-   **`VIEW_ID`** ‚Üí C√≥digo da imagem da pe√ßa.
